<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ketone Level Estimator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .input-label {
            @apply block text-gray-700 text-sm font-bold mb-2 text-left;
        }
        .input-field {
            @apply shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 leading-tight focus:outline-none focus:shadow-outline;
        }
        .btn {
            @apply bg-sky-600 hover:bg-sky-700 text-white font-bold py-3 px-6 rounded-lg focus:outline-none focus:shadow-outline w-full transition-colors duration-300;
        }
        .result-card {
            @apply mt-6 p-6 rounded-lg shadow-lg transition-all duration-500;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">

    <div class="w-full max-w-md mx-auto p-4 sm:p-6">
        <div class="bg-white rounded-xl shadow-2xl p-8">
            <div class="text-center mb-8">
                <h1 class="text-2xl sm:text-3xl font-bold text-gray-800">Ketone Level Estimator</h1>
                <p class="text-gray-500 mt-2">Enter CIE LAB color values for an estimation</p>
            </div>

            <!-- Form for LAB input -->
            <form id="lab-form" class="space-y-6">
                <div>
                    <label for="l-value" class="input-label">Lightness (L*)</label>
                    <input type="number" step="any" id="l-value" class="input-field" placeholder="0-100" required>
                </div>
                <div>
                    <label for="a-value" class="input-label">Green-Red Axis (a*)</label>
                    <input type="number" step="any" id="a-value" class="input-field" placeholder="-128 to 127" required>
                </div>
                <div>
                    <label for="b-value" class="input-label">Blue-Yellow Axis (b*)</label>
                    <input type="number" step="any" id="b-value" class="input-field" placeholder="-128 to 127" required>
                </div>
                <button type="submit" class="btn">Calculate</button>
            </form>

            <!-- Result display area -->
            <div id="result-container" class="result-card bg-gray-50 hidden">
                 <h3 class="text-xl font-bold text-center mb-2" id="result-level"></h3>
                 <p class="text-center text-gray-600" id="result-description"></p>
            </div>
            
            <!-- Disclaimer -->
            <div class="mt-8 text-center text-xs text-gray-400">
                <p>⚠️ Disclaimer: This is not a medical device. The results are an estimation based on the input color and should not replace professional medical advice.</p>
            </div>
        </div>
    </div>

    <script>
        // Reference colors for ketone levels based on typical urine strip colors
        const ketoneLevels = [
            { name: 'Negative', l: 92, a: 2, b: 18, color: 'bg-gray-200', description: 'Ketone level is in the normal range.' },
            { name: 'Trace', l: 85, a: 15, b: 10, color: 'bg-pink-200', description: 'A trace amount of ketones was detected. (approx. 0.5 mmol/L)' },
            { name: 'Small', l: 78, a: 30, b: 5, color: 'bg-rose-300', description: 'Ketone level is small. (approx. 1.5 mmol/L)' },
            { name: 'Moderate', l: 65, a: 45, b: -10, color: 'bg-fuchsia-400', description: 'Ketone level is moderate. (approx. 4.0 mmol/L)' },
            { name: 'Large', l: 50, a: 40, b: -25, color: 'bg-purple-500', description: 'Ketone level is large. (approx. 8.0 mmol/L)' },
            { name: 'Very Large', l: 40, a: 35, b: -30, color: 'bg-indigo-600', description: 'Ketone level is very large. Please consult a doctor. (approx. 16.0 mmol/L)' }
        ];

        const form = document.getElementById('lab-form');
        const resultContainer = document.getElementById('result-container');
        const resultLevel = document.getElementById('result-level');
        const resultDescription = document.getElementById('result-description');

        form.addEventListener('submit', function(event) {
            event.preventDefault();

            const l_input = parseFloat(document.getElementById('l-value').value);
            const a_input = parseFloat(document.getElementById('a-value').value);
            const b_input = parseFloat(document.getElementById('b-value').value);

            // Basic validation
            if (isNaN(l_input) || isNaN(a_input) || isNaN(b_input)) {
                // Using a custom modal/alert would be better, but for simplicity, we use the browser alert.
                // In a real app, replace this with a styled message box.
                const messageBox = document.createElement('div');
                messageBox.textContent = 'Please enter valid numerical values.';
                messageBox.style.cssText = 'position:fixed; top:20px; left:50%; transform:translateX(-50%); background-color: #f8d7da; color: #721c24; padding: 1rem; border-radius: 0.5rem; border: 1px solid #f5c6cb; z-index: 1000;';
                document.body.appendChild(messageBox);
                setTimeout(() => messageBox.remove(), 3000);
                return;
            }

            let closestMatch = null;
            let minDistance = Infinity;

            // Find the closest color match using Euclidean distance in the LAB color space.
            // This is a simplified version of the Delta E formula.
            ketoneLevels.forEach(level => {
                const deltaL = l_input - level.l;
                const deltaA = a_input - level.a;
                const deltaB = b_input - level.b;
                const distance = Math.sqrt(deltaL * deltaL + deltaA * deltaA + deltaB * deltaB);

                if (distance < minDistance) {
                    minDistance = distance;
                    closestMatch = level;
                }
            });

            // Display the result
            if (closestMatch) {
                resultLevel.textContent = `Estimated Level: ${closestMatch.name}`;
                resultDescription.textContent = closestMatch.description;
                
                // Update result card color and text color for better contrast
                resultContainer.className = 'result-card text-center ' + closestMatch.color;
                if (closestMatch.name === 'Large' || closestMatch.name === 'Very Large') {
                     resultLevel.classList.add('text-white');
                     resultDescription.classList.add('text-gray-100');
                } else {
                     resultLevel.classList.remove('text-white');
                     resultDescription.classList.remove('text-gray-100');
                }
                
                resultContainer.classList.remove('hidden');
            }
        });
    </script>
</body>
</html>
